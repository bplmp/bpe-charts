<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="utf-8">
  <title>Closed Loop Wallboard Sankey Diagram - BPE</title>
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <!-- <script type="text/javascript" src="http://livejs.com/live.js"></script> -->
</head>

<body>
  <div class="container-fluid" style="margin-top: 1em">
    <h3>Waste Wallboard Flows - US</h3>

    <!-- <div class="row">
      <div class="col">
      </div>
      <div class="col">
        <p>Post consumer content in Wallboard: <span id="postConsumerOut"></span>%</p>
        <input id="postConsumerSlider" type="range" min="15" max="30" value="15">
      </div>
    </div> -->

    <div class="row">
      <div class="col">
        <h4>Current Scenario</h4>
        <div id="sankey-current" style="width: 100%; height: 100%;"></div>
      </div>
      <div class="col">
        <h4>Potential Current Scenario</h4>
        <div id="sankey-potential" style="width: 100%; height: 100%;"></div>
      </div>
    </div>

    <div class="row" style="margin-top: 1em">
      <div class="col">
        <ul>
          <li>(1) <a href="https://www.buildingproductecosystems.org/s/cdra_benefits_of_cd_recycling_final_revised_2017.pdf" target="_blank">CDRA, 2017</a>: "Benefits of Construction and Demolition Debris Recycling in the US." Considering 71% of trim scraps and C&D wallboard going to landfill, same report.</li>
          <li>(2) Considering 2019 US production of wallboard of 24,000 million square feet (<a href="https://www.buildingproductecosystems.org/s/USGS-Gypsum-MCS_2020.pdf" target="_blank">USGS, 2020</a>); wallboard density of 0.00105 tons per square foot for a 5/8" thickness board (<a href="https://www.buildingproductecosystems.org/s/City-of-Napa_Conversion-Sheet.pdf" target="_blank">City of Napa</a>). This would mean 25.2 million metric tons of new wallboard produced per year, 10% of that being scraps.</li>
          <li>(3) Considering gypsum in C&D fines to be proportional to quantity of gypsum drywall in all C&D, and considering that all gypum fines are going to landfill. <a href="https://www.buildingproductecosystems.org/s/cdra_benefits_of_cd_recycling_final_revised_2017.pdf" target="_blank">CDRA, 2017</a>. In a potential scenario, we could greatly reduce fines (considering 90% reduction) in C&D by source-separating Gypsum Wallboard.</li>
          <li>(4) Considering a 50/50 split in recycled trim scraps between new wallboard and soil amendment. Total quantity of new wallboard recycled from <a href="https://www.buildingproductecosystems.org/s/USGS-Gypsum-MCS_2020.pdf" target="_blank">USGS, 2020</a>.</li>
          <li>(5) Considering that up to 15% of new wallboard could be made of post-consumer material. Total quantity of new wallboard from <a href="https://www.buildingproductecosystems.org/s/USGS-Gypsum-MCS_2020.pdf" target="_blank">USGS, 2020</a>.</li>
          <li>(6) Considering that up to 5% of new cement could be made of post-consumer gypsum. Total quantity of new wallboard from <a href="https://www.buildingproductecosystems.org/s/USGS-Gypsum-MCS_2020.pdf" target="_blank">USGS, 2020</a>.</li>
          <li>(7) Considering 3.49 million tons of gypsum used in soil amendment. <a href="https://www.buildingproductecosystems.org/s/cdra_benefits_of_cd_recycling_final_revised_2017.pdf" target="_blank">CDRA, 2017</a>.</li>
          <li>(8) Pre 1990's wallboard should be landfilled unless tested negative for abestos. We are unsure of the current percentage of pre 1990's wallboard in C&D material today, so we assume that in a potential scenario all of the wallboard that has to be landfilled is from this time period.</li>
          <p>Note: these are our best estimates, based on the most recent available data.</p>
        </ul>
      </div>
    </div>
  </div>

  <script type="text/javascript">
    google.charts.load('current', {
      'packages': ['sankey']
    });
    google.charts.setOnLoadCallback(drawAllCharts);

    var k = {
      'wallboard_produced': {
        'total': 25.2,  // usgs, 2019
        'pct_potential_post_consumer': 0.15,  // amanda
        get potential_post_consumer() {
          return k.wallboard_produced.total * k.wallboard_produced.pct_potential_post_consumer
        }
      },
      'wallboard_out_of_spec': {
        'pct_of_produced': 0.1,  // amanda
        'recycled': 0.7,  // usgs, 2019
        get total() {
            return k.wallboard_produced.total * k.wallboard_out_of_spec.pct_of_produced
        }
      },
      'jobsite_wallboard_scraps': {
        'pct_scraps': 0.1, // amanda
        get total() {
          return k.wallboard_produced.total * (1 - k.wallboard_out_of_spec.pct_of_produced) * k.jobsite_wallboard_scraps.pct_scraps
        }
      },
      'cnd_wallboard': {
        // 'total': 13.5,  // cdra, 2017
        get total() {
          return 13.5 - k.jobsite_wallboard_scraps.total
        },
        'landfill_pct': 0.71,  // cdra, 2017
        'pct_recycled_soil_amendment': 3.49 / 3.9, // cdra, 2017
        'pct_recycled_new_wallboard': 0.41 / 3.9, // cdra, 2017
        'pct_landfilled_wallboard_is_pre_1990s': 1.0,  // in our new scenario, we can assume that everything going to landfill is pre 1990's demolition wallboard
        get not_landfilled() {
          return k.cnd_wallboard.total * (1 - k.cnd_wallboard.landfill_pct)
        }
      },
      'cnd': {
        'total': 164,  // cdra, 2017
        'wallboard': 15.1,  // cdra, 2017
        'gypsum_fines_reduction_factor': 0.9,  // we can greatly reduce fines if we source separate GWB
        get percent_wallboard_in_cnd() {
          return k.cnd.wallboard / k.cnd.total
        },
        get gypsum_fines() {
          return k.cnd.wallboard * k.cnd.percent_wallboard_in_cnd
        }
      },
      'cement': {
        'total': 86,  // usgs, 2019
        'pct_potential_gypsum': 0.05,  // amanda
        get potential_gypsum() {
          return k.cement.total * k.cement.pct_potential_gypsum
        }
      },
      'soil_amendment': {
        // 'total_gypsum': 2.4,  // terry weaver, 2015
        'total_gypsum': 3.49,  // cdra, 2017
      },
    }

    function rowsCurrent(k) {
      return [
        ['Gypsum Fines from C&D (3)', 'Landfill', k.cnd.gypsum_fines],
        ['New Wallboard (Out of Spec) (2)', 'Landfill', k.wallboard_out_of_spec.total - k.wallboard_out_of_spec.recycled],
        ['New Wallboard (Out of Spec) (2)', 'New Wallboard (4)', k.wallboard_out_of_spec.recycled / 2],
        ['New Wallboard (Out of Spec) (2)', 'Soil Amendment (4)', k.wallboard_out_of_spec.recycled / 2],
        ['Demolition and Renovation Wallboard (1)', 'Soil Amendment (4)', k.cnd_wallboard.not_landfilled * k.cnd_wallboard.pct_recycled_new_wallboard],
        ['Demolition and Renovation Wallboard (1)', 'New Wallboard (4)', k.cnd_wallboard.not_landfilled * k.cnd_wallboard.pct_recycled_soil_amendment],
        ['Demolition and Renovation Wallboard (1)', 'Landfill', k.cnd_wallboard.total * k.cnd_wallboard.landfill_pct],
        ['Jobsite Wallboard Trim Scrap', 'New Wallboard (4)', k.jobsite_wallboard_scraps.total / 4],
        ['Jobsite Wallboard Trim Scrap', 'Soil Amendment (4)', k.jobsite_wallboard_scraps.total / 4],
        ['Jobsite Wallboard Trim Scrap', 'Landfill', k.jobsite_wallboard_scraps.total / 2],
      ]
    }
    var colorsCurrent = [
      '#555',
      '#ec7c04',
      '#555',
      '#0BD1AE',
      '#0BD1AE',
      '#555',
      '#555',
      '#0BD1AE',
    ];

    k.potential = {
      get out_of_spec_to_new_wallboard() {
        return k.wallboard_out_of_spec.total
      },
      get trim_scrap_to_new_wallboard() {
        return k.wallboard_produced.potential_post_consumer - k.wallboard_out_of_spec.total
      },
      get trim_scrap_to_soil_amendment() {
        return k.jobsite_wallboard_scraps.total - this.trim_scrap_to_new_wallboard
      },
      get cnd_to_soil_amendment() {
        return k.soil_amendment.total_gypsum - this.trim_scrap_to_soil_amendment
      },
      get cnd_to_cement_manufacturing() {
        return k.cement.potential_gypsum
      },
      get cnd_to_landfill() {
        return k.cnd_wallboard.total - this.cnd_to_soil_amendment - this.cnd_to_cement_manufacturing
      },
      get gypsum_fines_to_landfill() {
        return k.cnd.gypsum_fines * (1 - k.cnd.gypsum_fines_reduction_factor)
      },
    }

    function rowsPotential(k) {
        return [
          ['New Wallboard (Out of Spec) (2)', 'Potential New Wallboard (5)', k.potential.out_of_spec_to_new_wallboard],
          ['Jobsite Wallboard Trim Scrap', 'Potential New Wallboard (5)', k.potential.trim_scrap_to_new_wallboard],
          ['Jobsite Wallboard Trim Scrap', 'Potential Soil Amendment (7)', k.potential.trim_scrap_to_soil_amendment],
          // ['Demolition and Renovation Wallboard (1)', 'Potential New Wallboard (5)', k.wallboard_produced.potential_post_consumer - k.wallboard_out_of_spec.total],
          ['Demolition and Renovation Wallboard (1)', 'Potential Soil Amendment (7)', k.potential.cnd_to_soil_amendment],
          ['Demolition and Renovation Wallboard (1)', 'Potential Cement Manufacturing (6)', k.potential.cnd_to_cement_manufacturing],
          ['Demolition and Renovation Wallboard (1)', 'Landfill (8)', k.potential.cnd_to_landfill],
          // ['Pre 1990\'s Wallboard (8)', 'Landfill', k.cnd_wallboard.pct_landfilled_wallboard_is_pre_1990s * (
          //   k.cnd_wallboard.total -
          //     (k.cement.total * k.cement.pct_potential_gypsum)
          //     - k.soil_amendment.total_gypsum -
          //     (k.wallboard_produced.potential_post_consumer - (k.wallboard_out_of_spec.total))
          // )],
          ['Gypsum Fines from C&D (3)', 'Landfill (8)', k.potential.gypsum_fines_to_landfill],
        ]
    }
    var colorsPotential = [
      '#555',
      '#0BD1AE',
      '#555',
      '#0BD1AE',
      '#555',
      '#0BD1AE',
      '#ec7c04',
      '#555',
      '#555',
    ];

    function drawChart(id, rows, colors, addLabels) {
      console.log(id, rows);
      // round numbers
      for (var i = 0; i < rows.length; i++) {
        rows[i][2] = parseFloat(rows[i][2].toFixed(2))
      }

      if (addLabels) {
        // add labels
        var labels = {}
        for (var i = 0; i < rows.length; i++) {
          var from = rows[i][0]
          var to = rows[i][1]
          var quantity = rows[i][2]
          if (labels[from]) {
            labels[from] += quantity
          } else {
            labels[from] = quantity
          }
          if (labels[to]) {
            labels[to] += quantity
          } else {
            labels[to] = quantity
          }
        }
        for (var k in labels) {
          if (labels.hasOwnProperty(k)) {
            var quantity = parseFloat(labels[k].toFixed(2))
            labels[k] = k + ' [' + quantity + ' mi t]';
          }
        }
        for (var i = 0; i < rows.length; i++) {
          var from = rows[i][0]
          var to = rows[i][1]
          rows[i][0] = labels[from]
          rows[i][1] = labels[to]
        }
      }

      var data = new google.visualization.DataTable();
      data.addColumn('string', 'From');
      data.addColumn('string', 'To');
      data.addColumn('number', 'Million Metric Tons Per Year');
      data.addRows(rows);

      var options = {
        height: 600,
        sankey: {
          node: {
            colors: colors,
            nodePadding: 10,
            label: {
              fontName: 'sans serif',
              fontSize: 14,
            }
          },
          link: {
            colorMode: 'gradient',
            colors: colors
          },
          iterations: 0  // chart drawing will respect input data order
        }
      };

      // Instantiates and draws our chart, passing in some options.
      var chart = new google.visualization.Sankey(document.getElementById(id));
      chart.draw(data, options);
    }

    function drawAllCharts() {
      drawChart('sankey-current', rowsCurrent(k), colorsCurrent, false)
      drawChart('sankey-potential', rowsPotential(k), colorsPotential, false)
    }

    // // sliders
    // var slider = document.getElementById("postConsumerSlider");
    // var output = document.getElementById("postConsumerOut");
    // output.innerHTML = slider.value;
    //
    // slider.oninput = function() {
    //   var val = this.value
    //   output.innerHTML = val
    //   k.wallboard_produced.pct_potential_post_consumer = val / 100
    //   drawChart('sankey-potential', rowsPotential(k), colorsPotential, false)
    // }
  </script>
</body>
</html>
